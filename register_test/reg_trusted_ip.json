{
  "TestName": "reg_trusted_ip_test",
  "AutoTest": true,
  "Users": [
    {
      "UserId": 1,
      "Number": "157",
      "Login": "157",
      "Password": "123",
      "SipDomain": "%%DEV_DOM%%",
      "Expires": 90,
      "SipGroup": "sip.ab",
      "Port": 10106,
      "QParam": 0.5,
      "RegMode": "Manual",
      "BindPort": 10106
    },
    {
      "UserId": 2,
      "Number": "158",
      "Login": "158",
      "Password": "123",
      "SipDomain": "%%DEV_DOM%%",
      "Expires": 90,
      "SipGroup": "sip.ab",
      "Port": 10109,
      "QParam": 0.5,
      "RegMode": "Manual",
      "BindPort": 10109
    },
    {
      "UserId": 3,
      "Number": "159",
      "Login": "159",
      "Password": "123",
      "SipDomain": "%%DEV_DOM%%",
      "Expires": 90,
      "SipGroup": "sip.ab",
      "Port": 10110,
      "QParam": 0.5,
      "RegMode": "Manual",
      "BindPort": 10110
    }
  ],
  "UserVar": [
    {}
  ],
  "PreConf": [],
  "PostConf": [
    "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force",
    "/domain/%%DEV_DOM%%/sip/user/clean %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip --force",
    "/domain/%%DEV_DOM%%/sip/user/clean %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% trusted-ip --force"
  ],
  "Tests": [
    {
      "Name": "set_only_ip_succ_ip_reg",
      "Description": "Параметры: strict=no; digest=true; trusted-ip=local_ip. Результат: юзер проходит аутентификацию по ip",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no %%IP%%",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_wout_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_with_auth.xml"
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_wout_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_ip_and_port_succ_ip_reg",
      "Description": "Параметры: strict=no; digest=true; trusted-ip=local_ip, trusted-port=local_port. Результат: юзер проходит аутентификацию по ip",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no %%IP%%:%%1.Port%%",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_wout_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_with_auth.xml"
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_wout_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_foreign_ip_succ_digest_reg",
      "Description": "Параметры: strict=no; digest=true; trusted-ip=foreign_ip, trusted-port=local_port. Результат: юзер проходит digest аутентификацию.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no 1.1.1.1:%%1.Port%%",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_with_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_with_auth.xml"
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_with_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_foreign_port_succ_digest_reg",
      "Description": "Параметры: strict=no; digest=true; trusted-ip=local_ip, trusted-port=foreign_port. Результат: юзер проходит digest аутентификацию.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no %%IP%%:123",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_with_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_with_auth.xml"
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_with_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_foreign_ip_fail_ip_reg",
      "Description": "Параметры: strict=yes; digest=true; trusted-ip=foreign_ip, trusted-port=local_port. Результат: юзер не проходит аутентификацию по ip.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= yes 4.2.4.2:%%1.Port%%",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/failed_registration_with_auth.xml",
                "need_drop": false
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_403",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_recv_403.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_foreign_port_fail_ip_reg",
      "Description": "Параметры: strict=yes; digest=true; trusted-ip=local_ip, trusted-port=foreign_port. Результат: юзер не проходит аутентификацию по ip.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= yes %%IP%%:123",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/failed_registration_with_auth.xml",
                "need_drop": false
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_403",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_recv_403.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_foreign_port_range_fail_ip_reg",
      "Description": "Параметры: strict=yes; digest=true; trusted-ip=local_ip, trusted-port=foreign_port_range. Результат: юзер не проходит аутентификацию по ip.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= yes %%IP%%:123-125",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/failed_registration_with_auth.xml",
                "need_drop": false
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_403",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_recv_403.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_port_range_succ_ip_reg",
      "Description": "Параметры: strict=no; digest=true; trusted-ip=local_ip, trusted-port=local_port_range. Результат: юзер проходит аутентификацию по ip",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no %%IP%%:123-%%1.Port%%",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip strict= no %%IP%%:%%2.Port%%-65535",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_wout_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_wout_auth.xml"
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_wout_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_foreign_port_range_succ_digest_reg",
      "Description": "Параметры: strict=no; digest=true; trusted-ip=local_ip, trusted-port=foreign_port_range. Результат: юзер проходит digest аутентификацию.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no %%IP%%:123-125",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/info %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% --complete"
          ]
        },
        {
          "Sleep": 5
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_with_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_with_auth.xml"
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_with_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_foreign_ip_range_fail_ip_reg",
      "Description": "Параметры: strict=yes; digest=true; trusted-ip=foreign_ip_range. Результат: юзер не проходит аутентификацию по ip.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= yes 1.2.1.2-4.0.3.1",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/failed_registration_with_auth.xml",
                "need_drop": false
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_403",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_recv_403.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_ip_range_succ_ip_reg",
      "Description": "Параметры: strict=no; digest=true; trusted-ip=local_ip_range, trusted-port=local_port_range. Результат: юзер проходит аутентификацию по ip",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no 1.1.1.1-%%IP%%",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip strict= no 1.1.1.1-%%IP%%:123-%%2.Port%%",
            "/domain/%%DEV_DOM%%/sip/user/set %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% trusted-ip strict= no 1.1.1.1-%%IP%%:%%3.Port%%-65535",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%3.Number%%@%%3.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_wout_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_wout_auth.xml"
              },
              "3": {
                "script": "register_test/success_registration_wout_auth.xml",
                "need_drop": true
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_wout_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_foreign_ip_range_succ_digest_reg",
      "Description": "Параметры: strict=no; digest=true; trusted-ip=foreign_ip_range, trusted-port=local_port_range. Результат: юзер проходит digest аутентификацию.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no 1.1.1.1-3.4.1.3:112-%%1.Port%%",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_with_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_with_auth.xml"
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_with_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_foreign_ip_with_mask_fail_ip_reg",
      "Description": "Параметры: strict=yes; digest=true; trusted-ip=foreign_network, trusted-port=local_port. Результат: юзер не проходит аутентификацию по ip.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= yes 1.1.1.1/24:%%1.Port%%",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/failed_registration_with_auth.xml",
                "need_drop": false
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_403",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_recv_403.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_ip_range_with_mask_succ_ip_reg",
      "Description": "Параметры: strict=no; digest=true; trusted-ip=local_network, trusted-port=local_port_range. Результат: юзер проходит аутентификацию по ip",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no %%IP%%/24:%%1.Port%%",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip strict= no %%IP%%/32:112-%%2.Port%%",
            "/domain/%%DEV_DOM%%/sip/user/set %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% trusted-ip strict= no %%IP%%/0:%%3.Port%%-65535",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%3.Number%%@%%3.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_wout_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_wout_auth.xml"
              },
              "3": {
                "script": "register_test/success_registration_wout_auth.xml",
                "need_drop": true
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_wout_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_foreign_ip_range_with_mask_succ_digest_reg",
      "Description": "Параметры: strict=no; digest=true; trusted-ip=foreign_network. Результат: юзер проходит digest аутентификацию.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no 1.1.1.1/24",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_with_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_with_auth.xml"
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_with_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_multirange_succ_ip_reg",
      "Description": "Параметры: strict=no; digest=true; trusted-ip=local_ip_range, trusted-port=local_port_range. Результат: юзер проходит ip авторизацию.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no 1.1.1.1/24,.%%IP%%, 2.2.2.2-4.4.4.4:133-422",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip strict= no 1.1.1.1:1234, %%IP%%/16, 2.6.2.7-4.4.4.4",
            "/domain/%%DEV_DOM%%/sip/user/set %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% trusted-ip strict= no 1.1.1.1:1234, 1.1.1.1-%%IP%%:123-%%3.Port%%, 4.6.7.3/32",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%3.Number%%@%%3.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_wout_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_wout_auth.xml"
              },
              "3": {
                "script": "register_test/success_registration_wout_auth.xml",
                "need_drop": true
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_wout_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_multirange_fail_ip_reg",
      "Description": "Параметры: strict=yes; digest=true; trusted-ip=foreign_tranport. Результат: юзер не проходит авторизацию",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= yes 1.1.1.1/24, %%IP%%:123, 2.2.2.2-4.4.4.4:133-422",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip strict= yes 1.1.1.1:1234, %%IP%%/16:111, 2.6.2.7-4.4.4.4",
            "/domain/%%DEV_DOM%%/sip/user/set %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% trusted-ip strict= yes 1.1.1.1:1234, 1.1.1.1-2.2.2.2:123-%%3.Port%%, 4.6.7.3/32",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%3.Number%%@%%3.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/failed_registration_with_auth.xml",
                "need_drop": false
              },
              "2": {
                "script": "register_test/failed_registration_with_auth.xml",
                "need_drop": false
              },
              "3": {
                "script": "register_test/failed_registration_with_auth.xml",
                "need_drop": false
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_403",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_recv_403.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "set_multirange_succ_digest_reg",
      "Description": "Параметры: strict=no; digest=true;trusted-ip=foreign_tranport. Результат: юзер проходит digest аутентификацию",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= no 1.1.1.1/24, %%IP%%:123, 2.2.2.2-4.4.4.4:133-422",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip strict= no 1.1.1.1:1234, %%IP%%/16:111, 2.6.2.7-4.4.4.4",
            "/domain/%%DEV_DOM%%/sip/user/set %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% trusted-ip strict= no 1.1.1.1:1234, 1.1.1.1-2.2.2.2:123-%%3.Port%%, 4.6.7.3/32",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%3.Number%%@%%3.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_with_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_with_auth.xml"
              },
              "3": {
                "script": "register_test/success_registration_with_auth.xml",
                "need_drop": true
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_with_auth.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "1",
              "2"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%3.SipGroup%% %%3.Number%%@%%3.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "no_trusted_ip_only_strict",
      "Description": "Параметры: strict=yes/no; digest=true; Результат: юзер проходит digest аутентификацию.",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= yes",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip strict= no",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true",
            "/domain/%%DEV_DOM%%/sip/user/set %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/failed_registration_with_auth.xml"
              },
              "2": {
                "script": "register_test/success_registration_with_auth.xml"
              },
              "3": {
                "script": "register_test/success_registration_with_auth.xml"
              }
            }
          }
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 1,
              "Name": "UAC_RECV_403",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_recv_403.xml",
                  "Options": "-m 1 -set CDPN %%2.Number%% -set CDPNDOM %%2.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "StartUA": [
            {
              "Type": "User",
              "UserId": 3,
              "Name": "UAS_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "simple_ua/uas_recv_bye.xml",
                  "Options": "-m 1",
                  "SippType": "uas",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            },
            {
              "Type": "User",
              "UserId": 2,
              "Name": "UAC_RECV_BYE",
              "Commands": [
                {
                  "SourceFile": "register_test/uac_with_auth.xml",
                  "Options": "-m 1 -set CDPN %%3.Number%% -set CDPNDOM %%3.SipDomain%%",
                  "SippType": "uac",
                  "NeedAuth": true,
                  "Timeout": "20s"
                }
              ]
            }
          ]
        },
        {
          "DropManualReg": {
            "Users": [
              "3",
              "2",
              "1"
            ]
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force",
            "/domain/%%DEV_DOM%%/sip/user/clean %%2.SipGroup%% %%2.Number%%@%%2.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    },
    {
      "Name": "test_clean_trusted_ip",
      "Description": "Параметры: strict=no; digest=true trusted-ip=foreign_ip; Устанавливаем trusted-ip в foreign_ip, регистрация отбивается, делаем clean trusted-ip, юзер проходит digest",
      "TestProcedure": [
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip strict= yes 1.1.1.1",
            "/domain/%%DEV_DOM%%/sip/user/set %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% digest true"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/failed_registration_with_auth.xml",
                "need_drop": false
              }
            }
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        },
        {
          "ManualReg": {
            "Users": {
              "1": {
                "script": "register_test/success_registration_with_auth.xml",
                "need_drop": true
              }
            }
          }
        },
        {
          "SendSSHCommand": [
            "/domain/%%DEV_DOM%%/sip/user/clean %%1.SipGroup%% %%1.Number%%@%%1.SipDomain%% trusted-ip --force"
          ]
        }
      ]
    }
  ]
}